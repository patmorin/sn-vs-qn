\documentclass[kpfonts]{patmorin}
\usepackage{pat}
\usepackage{paralist}

\setlength{\parskip}{1ex}


\DeclareMathOperator{\sn}{sn}
\renewcommand{\SS}{\mathcal{S}}

\begin{document}

\section{The Plan}

\begin{lem}\lemlabel{bbs}
  For every $k,s\in\N$, there exists $d,h,n\in\N$ such that the following is true.  Let $T$ be a complete $d$-ary tree of height $h$ and $P$ be a path of length $n$.  Then, for any $s$-stack layout $(\prec,\varphi)$ of $T\times P$, there exists an edge $(x,y)\in P$ and a complete binary subtree $T'$ of $T$ of height $h$ such that $(v,x) \prec (w,y)$ for every $v,w\in V(T')$.
\end{lem}

Note: Actually, we only need the $T'_x$ to be separated from the leaves of $T'_y$.

Once we have \lemref{bbs}, the rest of the proof is easy.  By David's argument, the layout of $T'_x$ contains a rainbow of size $\omega_h(1)$.  Now, the fact that $T'_x$ and the leaves of $T'_y$ are separated along with some easy applications of Dilwerth's Theorem (Erd\H{o}s-Szkeres) proves that any $s$-stack layout of $T'\boxtimes (x,y)$ contains a twist of size $\omega_h(1)$.

Now let's work on proving \lemref{bbs}.  

Let $V$ be any set, let $S=\{(v,b): v\in V, b\in\{0,1\}$, and let $\prec$ be a total order on $S$.  We say that $\prec$ \emph{separates} a subset $X\subseteq V$ if $(v,b) \prec (v,{1-b})$ for every $v\in X$ and some $b\in\{0,1\}$.  
% We say that $\prec$ \emph{mixes} $X$ if $\prec$ orders $X\times\{0,1\}$ as
% \[
%    (x_1,b)\prec (x_2,1-b)\prec (x_{3},b)\prec \cdots \prec (x_{2|X|},1-b) \enspace .
% \]



We say that $\prec$ \emph{interleaves} $X$ if there exists an ordering $x_1,\ldots,x_{|X|}$ of $X$ and $b_1,\ldots,b_{|X|}\in\{0,1\}^{|X|}$ such that 
\[
  (x_1,b_1)\prec(x_1,1-b_1)\prec(x_2,b_2)\prec(x_2,1-b_2)\prec\cdots\prec (x_{|X|},b_{|X|})\prec(x_{|X|},1-b_{|X|})
  \enspace .
\]
% We say that $\prec$ \emph{splits} $X$ if there exists an ordering $x_1,\ldots,x_{|X|}$ of $X$ and $b\in\{0,1\}$ if
% \[
%   (x_1,b)\prec (x_2,1-b)\prec\cdots\prec (x_{|X|},?)\prec(x_{|X|},1-?)\prec\cdots\prec (x_2,b)\prec(x_1,1-b) 
% \]







\begin{lem}\lemlabel{dichotomy}
  Let $V$ be any set, $|V|=m$, let $S=\{(v,b): v\in V, b\in\{0,1\}$, and let $\prec$ be a total order on $S$.  Then there exists a $\Omega(\sqrt{m})$-element subset $X\subseteq V$ such that $\prec$ separates $X$ or $\prec$ interleaves $X$.   
\end{lem}

\begin{proof}
  Scan $S$ in $\prec$ order.  If at the $i$'th iteration you see $i/2 + k$ distinct $v$ values, then you've found a set $X$ of size $k/2$ that $\prec$ separates.  If that never happens then, among the first $2k$ values, at least $k+1$ of them are matched.  Among the next $2k$ values $k+1$ of them are matched. At most $k-1$ of these matching edges go back to unmatched edges in previous blocks, so at least one matching edge is in the second block.  Proceed the same way to find $m/(2k)$ matched pairs.
\end{proof}


\begin{lem}\lemlabel{star-separation}
  For every $k,s\in\N$, there exists $d,n\in\N$ such that the following is true.
  Let $S$ be a $d$-leaf star and $P$ be an $n$-vertex path.  Then, in any $s$-stack layout $(\prec,\varphi)$ of $S\times P$, there exists an edge $xy\in E(P)$ and a $t$-vertex subset $S'\subset V(S)$ such that $(v,x) \prec (w,y)$ for every $v,w\in S'$.
\end{lem}

\begin{proof}
  Apply \lemref{dichotomy} iteratively to the copies of the leaves of $S$ generated by the path $P$.  If at any point we get a set $X$ such that $\prec$ splits $X$, then we're done.  Otherwise we have $n$ copies of a large star with their leaves interleaved.  This gives a large twist, which can't happen in an $s$-stack layout.  
\end{proof}


I think we're done.  

\begin{thm}
  For every $k\in\N$, there exists $d,h,n\in N$ such that the following is true.
  Let $T$ be a complete $d$-regular tree of height $h$ and let $P$ be a path of length $n$.  Then $\sn(T\boxtimes P)\ge k$.
\end{thm}

\begin{proof}
  Apply \lemref{star-separation} to the root of $T$ and its and its children to obtain an edge $xy\in E(P)$ and a $t$-element set $X$ of depth-$1$ nodes in $T$ such that $(v,x)\prec (w,y)$ for every $v,w\in X$.  Therefore, the layout contains a matching $M=\{(v,x)(v,y):v\in X\}$ of size $t$ whose left and right endpoints are separated.  An easy application of Dilwerth's Theorem implies that $X$ contains a subset $X'$ of size at least $\sqrt{t}$ that defines a rainbow, i.e., for every $v,w\in X'$, $(v,x)<(w,x)$ if and only if $(w,y)<(v,y)$.

  Now we use strong product.  For each node $x'\in X'$ with child $x''$, $T\boxtimes P$ contains the edges $(x',0)(x'',0)$ and $(x',0)(x'',1)$.  The only way to avoid a big twist is to interleave the $(x',0)$s and $(x'',0)$s.  The same thing is true about the $(x',1)$s and $(x'',1)$s.  But now we've found a big height-2 subtree. that is $\prec$ separated...... Hmmmmmm.
    % 
    % 
    % Another couple of applications of Dilwerth shows that this 
  % 
  % 
  % 
  % 
  % Let $Y$ be the children of the nodes in $X'$.
  % For each node $x  The graph $T\boxtimes P$ contains the edges $(v,x)
  % 
  % 
  % 
  %  set consisting of exactly one child from each element of $X$.  
  % 
\end{proof}





% Now, how to do we get from here to a large binary subtree, i.e., \lemref{bbs}?  I'm not sure yet, but we're getting close.  Here's an idea.  Find an enormous set of leaves at the root that are separated by $(x,y)$.   Now consider the (enormous) number of children of these leaves.  
% 






















% Let $S$ denote a star with root $s_0$ and $n$ leaves $s_1,\ldots,s_n$.  Let $P$ denote the path $p_1,\ldots,p_n$ of length $n$.  We are interested in stack layouts of $S\boxtimes P$ (and also $S\times P$).
% 
% For a total order $<$ over some set $X$, we say that two subsets $A,B\subseteq X$ are \emph{separated} with respect to $<$ if $a<b$ for all $a\in A$ and $b\in B$ or if $b<a$ for all $a\in A$ and $b\in B$.  In the former case, we write $A<B$ and in the latter case $B<A$.  A sequence of subsets $A_1,\ldots,A_r\subseteq X$ are \emph{separated} (with respect to $<$) if $A_i$ and $A_j$ are separated for every distinct $i,j\in\{1,\ldots,r\}$.
% 
% Let $G=S\boxtimes P$ and, for each $i\in\{0,\ldots,n\}$ and $j\in\{1,\ldots,n\}$, $v_{i,j}=(s_i,p_j)$.  For index sets $I\subseteq\{0,\ldots,n\}$ and $J\subseteq\{1,\ldots,n\}$, we define
% $v_{I,J}=\{v_{i,j}: i\in I,\, j\in J\}$.
% 
% \begin{lem}\lemlabel{twister}
%   Let $<$ denote a total order over $V(G)$ and suppose there exists $I,J\subseteq\{1,\ldots,n\}$ such that
%   \begin{compactenum} 
%     \item $|I|=|J|=k$; 
%     \item $v_{I,\{j\}}$ and $v_{I,\{j'\}}$ are separated for all distinct $j,j'\in J$.  
%   \end{compactenum}
%   Then the layout $(G,<)$ has a twist of size $k$.
% \end{lem}
% 
% \begin{proof}
%   Let $j_1,\ldots,j_{k}$ be the ordering of $J$ such that $v_{0,j_1}< v_{0,j_2}<\cdots< v_{0,j_{k}}$ and let $i_1,\ldots,i_{k}$ be the ordering of $I$ such that $v_{i_1,J}<v_{i_2,J}<\cdots<v_{i_k,J}$.  Then the edge set
%   \[   
%     \left\{ v_{0,j_a}v_{a,j_{a}} : j\in\{1,\ldots,k\} \right\}
%   \]
%   form a twist of size $|J|$.  Indeed, by definition,
%   \[
%       v_{0,j_1} < \cdots < v_{0,j_k}
%   \]
%   and, since $v_{i_1,J}<\cdots< v_{i_k,J}$, 
%   \[
%       v_{i_1,j_1} < v_{i_2,j_2} < \cdots < v_{i_{k},j_k} \enspace . \qedhere
%   \]   
% \end{proof}
% 
% % This next one is wrong:
% % \begin{cor}\corlabel{twister}
% %   Let $<$, $G$, $I$, $J$ satisfy Conditions 1 and 2 of \lemref{twister} (but not necessarily Condition~3).   Then the layout $(G,<)$ has a twist of size at least $\floor{k/2}$.
% % \end{cor}
% % 
% % \begin{proof}
% %   Let $j_1,\ldots,j_{k}$ be the ordering of $J$ such that $v_{0,j_1}< v_{0,j_2}<\cdots< v_{0,j_{k}}$ and consider the median element $v_{0,j_{\floor{k/2}}}$.  Then,  
% %   \begin{enumerate}
% %     \item There is a set $I'\subseteq I$, $|I'|\ge \floor{k/2}$ such that $v_{\{0\},\{j_{\floor{k/2}}\}} < v_{\{i\},J}$ for all $i\in I'$; or
% %     \item There is a set $I'\subseteq I$, $|I'|\ge \floor{k/2}$ such that $v_{\{i\},J} < v_{\{0\},\{j_{\floor{k/2}}\}}$ for all $i\in I'$.
% %   \end{enumerate}
% %   In the first case we can apply \lemref{twister} directly to the sets $I'$ and $J'=\{j_1,\ldots,j_\floor{k/2}\}$.  In the latter case we can apply \lemref{twister} (with condition 3 replaced by $\{v_{\{0\},J}\}>v_{I,J}$) to the sets $I'$ and $J'=\{j_{\floor{k/2}+1},\ldots,j_k\}$.  
% % \end{proof}
% 
% The preceding lemma dispenses with the possibility that $S\times P$ has an $S$-major layout.  The next lemma shows that, any layout of $S\times P$ that is not $S$-major has a large amount of interleaving.
% 
% \begin{lem}\lemlabel{blocks-or-interleave}
%    There exists a function $k:\N\to\N$ with $k(n)\in\omega_n(1)$ such that, for any ordering $<$ over $V(G)$,  at least one of the following is true:
%   \begin{enumerate}
%     \item The conditions of \corref{twister} hold with $|I|=|J|=k$.
%     \item There exists $I,J\subseteq\{1,\ldots,n\}$ with $|I|=|J|=k$ and an ordering $j_1,\ldots,j_k$ of $J$ such that $v_{I,j_1}< v_{I,j_2}<\cdots<v_{I,j_k}$.
%   \end{enumerate}
% \end{lem}
% 
% \begin{proof}
%   Consider the set $S$ of $tn$ leftmost vertices for some value of $t$ to be decided later.
%   \begin{enumerate}
%     \item If the vertices in $S$ take on at most $a$ different $J$-values then there is some $j$ and $I$, $|I|\ge\ceil{t/a}$ such that $S$ contains $v_{I,j}$ Save $I_1=I$ as an $I$-block and continue on $v_{I,[n]\setminus\{j\}}$. The point is that this gets us an $I$-block of size $\ceil{a/t}$ and lets us recurse on a set of size $\ceil{t/a}$.
% 
%     \item If the vertices in $S$ take on at most $a$ different $I$ values then there is some $i$ and $J$, $|J|\ge\ceil{t/a}$ such that $S$ contains $v_{i,J}$.  Save $J_0=J$ as a $J$-block and continue on $v_{[n]\setminus\{i\},J}$.  Here we get a $J$-block of size $\ceil{n/t}$ and get to recurse on a set of size $t/a$.
%   \end{enumerate}
%   We could take $t=n^2/2$ and $a=n/\log n$.  Then we can repeat this procedure $\log n-\log\log n$ times until we eventually get $\log n$ sets, the last of which has size $\log n$.  We can probably do better if we parameterize by $n$, the number of leaves in $S$ and $\ell$, the length of $P$. Maybe $\sqrt{n}$ is the right answer.
% \end{proof}
% 
% \begin{lem}\lemlabel{tiger}
%   For any constant $s$, and any $s$-stack layout of $G=S\times P$, there exists $I,J\subseteq\{1,\ldots,n\}$, $|I|=|J|\in\omega_n(1)$ and an ordering $j_1,\ldots,j_k$ of $J$ such that $v_{I\cup\{0\},j_1}< v_{I\cup\{0\},j_2}<\cdots<v_{I\cup\{0\},j_k}$.   
% \end{lem}
% 
% \begin{proof}
%   Use the previous lemma and argue that, in the second case, if we find large sets $I'\subseteq I$ and $J'\subseteq J$ such that $v_{0,J}<v_{I',J'}$ then we get a large rainbow (same in as in \lemref{twister}).  If we can't do that, then the same line of reasoning used in \lemref{blocks-or-interleave} proves the result.
% \end{proof}
% 
% Actually, what we've shown so far is that any $s$-stack layout of $n$ disjoint copies $S$ will contain $k$ separated copies of a subgraph of $S$.
% 
% Next step, extend \lemref{tiger} to show that any $s$-stack layout of the Cartesian product of the $n$-ary tree of height $2$ with $P$ has to have a large subtree that is interleaved.  
% 
% Finally, this should kill the possibility of an $s$-stack layout of the Cartesian product of the $n$-ary tree of height $2$ with shortcuts from the root to the leaves with a path.   


\end{document}
